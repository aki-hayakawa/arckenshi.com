<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Batam</title>



<link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.6.95/css/materialdesignicons.css" rel="stylesheet" />
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>
<style>
	.padding{
    padding:5rem !important;
    margin-left:300px;
}
.card {
    margin-bottom: 1.5rem;
} 

.card {
    position: relative;
    display: -ms-flexbox;
    display: flex;
    -ms-flex-direction: column;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 1px solid #c8ced3;
    border-radius: .25rem;
}

.card-header:first-child {
    border-radius: calc(0.25rem - 1px) calc(0.25rem - 1px) 0 0;
}

.card-header {
    padding: .75rem 1.25rem;
    margin-bottom: 0;
    background-color: #f0f3f5;
    border-bottom: 1px solid #c8ced3;
}

.card-body {
    flex: 1 1 auto;
    padding: 1.25rem;
}

.form-control:focus {
    color: #5c6873;
    background-color: #fff;
    border-color: #c8ced3 !important;
    outline: 0;
    box-shadow: 0 0 0 #F44336;
}
</style>
  </head>

  <body>
  	
<div class="row">
	<div class="col-sm-12">
	<div class="card">
		<div class="card-header">
		<strong>Batam PH Monitoring</strong>
			<small>last update : <span id="lastupdate"></span></small>
		</div></div></div></div>

  	
  	
<div class="row">
  <div class="col-sm-6">
    <div class="card">
      <div class="card-body">
        <div class="row">
          <div class="col-sm-3">
            <div class="form-group">
              <label for="name">Name</label>
              <input class="form-control" id="S1" type="text" placeholder="Enter your name">
            </div>
          </div>


          <div class="col-sm-3">
            <div class="form-group">
              <label for="name">Auto</label>
            <input id="AutomationState1" class="form-control" type="checkbox">
            </div>
          </div>


          <div class="col-sm-3">
            <div class="form-group">
              <label for="name">Relay</label>
            <input id="relay1" class="form-control" type="checkbox">
            </div>
          </div>


        </div>






        <div class="row">

          <div class="col-sm-4">
            <div class="form-group">
              <label for="cvv">Temperature</label>
              <input class="form-control" id="PH_Temperature1" type="text" placeholder="">
            </div>
          </div>

          <div class="col-sm-4">
            <div class="form-group">
              <label for="cvv">PH</label>
              <input class="form-control" id="PH_Value1" type="text" placeholder="">
            </div>
          </div>



          <div class="col-sm-4">
            <div class="form-group">
              <label for="cvv">Target</label>
              <input class="form-control" id="PH_Target1" type="text" placeholder="">
            </div>
          </div>

        </div>
      </div>
      <div class="card-footer">
        <button class="btn btn-sm btn-success float-right" type="submit">
          <i class="mdi mdi-gamepad-circle"></i> Continue </button>
      </div>
    </div>
  </div>
</div>
</body>
  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

	  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
	 </script>
	 <script type = "text/javascript" language = "javascript">
		var mqtt;
		var reconnectTimeout = 1000;
		var host="service.redtone.com"; //change this
		var port=8083;
		
		function onFailure(message) {
			console.log("Connection Attempt to Host "+host+"Failed");
			setTimeout(MQTTconnect, reconnectTimeout);
        }
		function onMessageArrived(msg){
			out_msg="Message received "+msg.payloadString+"<br>";
			out_msg=out_msg+"Message received Topic "+msg.destinationName;
			topic=msg.destinationName;
			let mydata = JSON.parse(msg.payloadString);
			var currentdate = new Date(); 
			var datetime = "Last Sync: " + currentdate.getDate() + "/"
			                + (currentdate.getMonth()+1)  + "/" 
			                + currentdate.getFullYear() + " @ "  
			                + currentdate.getHours() + ":"  
			                + currentdate.getMinutes() + ":" 
			                + currentdate.getSeconds();
			
			//console.log(datetime);
			$('#lastupdate').html(datetime);
			
			const keys = Object.keys(mydata);
			for (let i = 0; i < keys.length; i++) {
			  const key = keys[i];
			  //console.log(key, mydata[key]);
			  $(key).val(mydata[key]);
			  
			  if(key.substr(0, 10)=="Automation" || key.substr(0, 5)=="relay") {
			  	
			  		if(mydata[key]=='1') {
			  			$('#'+key+'').attr('Checked','Checked'); 
			  			//$('#'+key+'').prop('checked', true);
			  			//$('#'+key+'').attr('checked', 'checked');
			  			//alert(key+' - checked');
			  		} else {
			  			$('#'+key+'').removeAttr('Checked');  
			  			//$('#'+key+'').prop('checked', false);
			  			//$('#'+key+'').removeAttr('checked');
			  			//alert(key+' - no checked');
			  		}
			  		
			  			
			  } else {
			  	
			  	$('#'+key+'').val(mydata[key]);
			  }
			  
			  
			}
						
			//alert(mydata['PH_Target1']);
			//message=msg.payloadString;
			//const myArray = topic.split("/");

			//if (myArray[2])
			//	console.log(new Date(1549312452 * 1000).toISOString().slice(0, 19).replace('T', ' '));
			//riot/3ab1d96b-a7a6-4240-9b1d-41472e50b51d/distance | 5000
			//let item = myArray[1]+'_'+myArray[2];
			//console.log(topic +' | '+ msg.payloadString);


  		//$('#'+item+'').html(msg.payloadString);


		}
		
	 	function onConnect() {
	  // Once a connection has been made, make a subscription and send a message.
	
					console.log("Connected ");

	
	mqtt.subscribe("/batam/B1/info");

	



					//message = new Paho.MQTT.Message("Hello World");
					//message.destinationName = "sensor2";
					//message.retained=true;
					//mqtt.send(message);
	  }
	  function MQTTconnect() {
		console.log("connecting to "+ host +" "+ port);
		var x=Math.floor(Math.random() * 10000000000); 
		var cname="riotClient-"+x;
		mqtt = new Paho.MQTT.Client(host,port,cname);
		//document.write("connecting to "+ host);
		var options = {
			timeout: 3,
			useSSL:true,
			onSuccess: onConnect,
			onFailure: onFailure,
			 };
		mqtt.onMessageArrived = onMessageArrived
		
		mqtt.connect(options); //connect
		}
	 	MQTTconnect();
	  </script>
</html>